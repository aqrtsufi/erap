import{C as e,D as t,E as n,F as r,I as i,L as a,M as o,N as s,O as c,P as l,R as u,T as d,_ as f,b as p,f as ee,g as te,h as ne,j as m,m as h,p as re,t as ie,u as ae,v as g,w as _,x as v}from"./vendor-37PY1DHN.js";import{t as y}from"./search-CKcgQAWs.js";import{a as oe,d as b,i as se,l as ce,o as le,p as ue,s as x,t as de,u as fe}from"./storage-D2DYIOgH.js";import{t as pe}from"./epub-37iu7sur.js";function me(e){let t=e.classList.contains(`noteref`)||e.classList.contains(`footnote-ref`)||e.classList.contains(`footnoteRef`)||e.classList.contains(`endnote`)||e.classList.contains(`endnote-ref`),n=e.getAttribute(`role`)===`doc-noteref`,r=(e.getAttribute(`epub:type`)||``).split(/\s+/).includes(`noteref`),i=(e.getAttribute(`rel`)||``).split(/\s+/).includes(`footnote`),a=e.getAttribute(`href`)||``,o=a.includes(`#`)&&/#(fn[-_]?|footnote|note|endnote)/i.test(a);return t||n||r||i||o}async function S(e){let t=e.trim();if(!t)return null;try{let e=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(t)}`);if(!e.ok)return null;let n=await e.json(),r=[];for(let e of n||[])for(let t of e.meanings||[])for(let e of t.definitions||[])e.definition&&r.push(e.definition);return r.length?r.slice(0,6).join(`
`):null}catch{return null}}function he(e,t,n){return(e||``).trim().replace(/\s+/g,` `).toLowerCase()===`the quran`?`quran`:`default`}function C(e,t){if(e===`quran`){let e=t.author?`Translated by ${t.author}`:`Translation`,n=t.verseHint?`(${t.verseHint})`:t.chapter?`(${t.chapter})`:``;return`${e}. ${t.title} ${n}`.trim()}let n=t.author?`${t.author}. `:``,r=t.chapter?` ${t.chapter}.`:``;return`${n}${t.title}.${r}`.replace(/\s+/g,` `).trim()}function w(e){let t=e.match(/^\s*(\d{1,3}\s*[:.]\s*\d{1,3})\b/)?.[1];if(t)return t.replace(/\s+/g,``);let n=e.match(/^\s*(\d{1,4})\b/)?.[1];if(n)return n}function ge(e){let t=w(e.selectedText),n=C(e.profile,{title:e.title,author:e.author,chapter:e.chapter,verseHint:t});return`"${e.selectedText.trim()}"\n\n— ${n}`}var T=3;function _e(){return new y.Index({tokenize:`forward`,resolution:9,cache:100})}function E(e){return(e||``).replace(/\s+/g,` `).trim()}function D(e,t){let n=E(e),r=n.toLowerCase().indexOf(t.toLowerCase());if(r<0)return n.slice(0,180)+(n.length>180?`…`:``);let i=Math.max(0,r-60),a=Math.min(n.length,r+t.length+100);return(i>0?`…`:``)+n.slice(i,a)+(a<n.length?`…`:``)}function O(e){if(e&&typeof e==`object`&&e.nodeType===9){let t=e;return E(t.body?.textContent||t.documentElement?.textContent||``)}let t=typeof e==`string`?e:String(e??``),n=new DOMParser,r=n.parseFromString(t,`application/xhtml+xml`);return r.getElementsByTagName(`parsererror`).length&&(r=n.parseFromString(t,`text/html`)),E(r.body?.textContent||r.documentElement?.textContent||``)}async function ve(e,t,n){let r=_e(),i=await x(e),a=i?.hrefText??{},o=i?.v,s=Object.values(a).reduce((e,t)=>e+(t?.length||0),0);(o!==T||s<500)&&(a={});let c=Object.keys(a);if(c.length>0){for(let e of c){let t=a[e];t&&r.add(e,t.toLowerCase())}return n?.(c.length,c.length,!0),{idx:r,hrefText:a,fromCache:!0}}let l=t?.spine?.items??[],u=l.length;for(let e=0;e<l.length;e++){let i=l[e]?.href;if(!i){n?.(e+1,u,!1);continue}try{let e=O(await t.load(i));e&&(a[i]=e,r.add(i,e.toLowerCase()))}catch{}n?.(e+1,u,!1),e%3==0&&await new Promise(e=>setTimeout(e,0))}return await b(e,{v:T,hrefText:a,updatedAt:Date.now()}),{idx:r,hrefText:a,fromCache:!1}}function k(e,t,n){let r=n.trim();return r?e.search(r.toLowerCase(),30).map(e=>typeof e==`string`?e:e.href).filter(Boolean).map(e=>({href:e,snippet:D(t[e]||``,r)})):[]}var A=`universal_reader_db`,j=1;async function M(){return ie(A,j,{upgrade(e){e.createObjectStore(`books`,{keyPath:`id`}),e.createObjectStore(`prefs`,{keyPath:`bookId`}),e.createObjectStore(`sessions`,{keyPath:`id`}),e.createObjectStore(`search`,{keyPath:`bookId`}),e.createObjectStore(`meta`,{keyPath:`key`})}})}async function N(e){await(await M()).put(`sessions`,e)}async function P(e){return(await(await M()).getAll(`sessions`)).filter(t=>t.bookId===e)}function F(){return crypto.randomUUID?.()??`${Date.now()}-${Math.random()}`}async function ye(e){let t={id:F(),bookId:e,startAt:Date.now()};return await N(t),t}async function be(e,t,n){let r=await(await M()).get(`sessions`,t);if(!r||r.bookId!==e)return;let i=Date.now(),a=Math.max(0,Math.round((i-r.startAt)/1e3));await N({...r,endAt:i,seconds:a,lastHref:n??r.lastHref})}async function xe(e){let t=await P(e);return{totalSeconds:t.reduce((e,t)=>e+(t.seconds??0),0),totalSessions:t.filter(e=>e.endAt).length}}function I(e){return String(e??``).replace(/\s+/g,` `).trim()}var Se={class:`h-full bg-base-100`},Ce={key:0,class:`fixed top-0 left-0 right-0 z-30 bg-base-200/95 backdrop-blur border-b border-base-300`},we={class:`navbar`},Te={class:`flex-1 min-w-0`},Ee={class:`ml-2 truncate font-semibold`},De={class:`px-3 pb-3`},Oe={key:0,class:`text-xs opacity-60 mt-1`},ke={key:1,class:`text-xs opacity-60 mt-1`},Ae={key:2,class:`mt-2 max-h-56 overflow-auto bg-base-100 rounded-xl border border-base-300`},je={class:`max-h-64 overflow-auto border border-base-300 rounded-md`},Me=[`onClick`],Ne={class:`text-xs opacity-60`},Pe={class:`text-sm`},Fe={class:`p-3 grid grid-cols-2 sm:grid-cols-4 gap-3`},Ie={class:`form-control`},Le={class:`form-control`},Re={class:`form-control`},ze={class:`form-control`},Be={class:`form-control col-span-2`},Ve={class:`form-control col-span-2`},He={class:`form-control col-span-2`},Ue={class:`form-control`},We={class:`form-control`},Ge={class:`flex items-center gap-2 cursor-pointer`},Ke={class:`flex items-center gap-2 cursor-pointer`},qe={key:3,class:`modal modal-open`},Je={class:`modal-box max-w-2xl`},Ye={class:`mt-4 max-h-[70vh] overflow-auto space-y-1`},Xe=[`onClick`],Ze={key:0,class:`opacity-70`},Qe=[`innerHTML`],L=_({__name:`ReaderView`,props:{id:{}},setup(ie){let _=l(de),y=ie,b=ae(),x=l(null),C=l(!0),w=l(null),T=l(`default`),E=0,D=l(!1),O=l(``),A=l([]),j=l(!1),M=l(0),N=l(0),P=l(!1),F=l(null),L=l(!1),$e=l([]),et=f(()=>{let e=[],t=(n,r)=>{for(let i of n??[])i?.href&&e.push({href:i.href,label:i.label||i.href,depth:r}),i?.subitems?.length&&t(i.subitems,r+1)};return t($e.value,0),e});function tt(){L.value=!0}function R(){L.value=!1}async function nt(e){R(),C.value=!0,await Tt(e.href)}function rt(e){e.key===`Escape`&&(C.value=!0,L.value=!1),(e.key===`t`||e.key===`T`)&&C.value&&(L.value=!L.value)}function it(e,t){let n=t.trim();if(!n)return null;let r=[],i=e.createTreeWalker(e.body,NodeFilter.SHOW_TEXT);for(;i.nextNode();){let e=i.currentNode;e.data&&e.data.trim()&&r.push(e)}let a=r.map(e=>e.data).join(``).toLowerCase().indexOf(n.toLowerCase());if(a<0)return null;let o=a+n.length,s=null,c=null,l=0,u=0,d=0;for(let e of r){let t=e.data.length;if(!s&&a<d+t&&(s=e,l=a-d),!c&&o<=d+t){c=e,u=o-d;break}d+=t}if(!s)return null;c||(c=s,u=Math.min(s.data.length,l+n.length));let f=e.createRange();return f.setStart(s,Math.max(0,l)),f.setEnd(c,Math.max(0,u)),f}async function at(e,t){let n=e?.document;if(!n?.body)return;let r=it(n,t);if(!r)return;let i=r.getBoundingClientRect(),a=e.window,o=a.scrollY+i.top-a.innerHeight*.33;a.scrollTo({top:Math.max(0,o),behavior:`instant`});try{r.startContainer?.parentElement?.scrollIntoView?.({block:`center`})}catch{}}async function ot(e){let t=O.value.trim();if(ht(),C.value=!0,!t){await q.display(e.href);return}F.value={href:e.href,query:t},await q.display(e.href)}let z=null,B={},V=l(!1),H=l(``),U=l(``),W=l(null),G=l(!1),K=null,q=null,J=null,st=f(()=>C.value?`pt-24`:`pt-0`),ct=f(()=>C.value?`pb-32`:`pb-0`),lt={},ut=!1;function Y(e){let t=decodeURIComponent(e||``).replace(/^#/,``).trim(),n=t.replace(/^fn-/,``),r=new Set([t,n,`fn-${n}`,t.replace(/_/g,`-`),t.replace(/-/g,`_`),n.replace(/_/g,`-`),n.replace(/-/g,`_`),`fn-${n.replace(/_/g,`-`)}`,`fn-${n.replace(/-/g,`_`)}`]);for(let e of Array.from(r))r.add(e.toLowerCase());return[...r].filter(Boolean)}function dt(e){if(e&&typeof e==`object`&&e.nodeType===9)return e;let t=typeof e==`string`?e:String(e??``),n=new DOMParser().parseFromString(t,`application/xhtml+xml`);return n.getElementsByTagName(`parsererror`).length&&(n=new DOMParser().parseFromString(t,`text/html`)),n}function ft(e){let t=window.CSS;return t?.escape?t.escape(e):e.replace(/([ !"#$%&'()*+,./:;<=>?@[\\\]^`{|}~])/g,`\\$1`)}function pt(e,t){return e.getElementById(t)??e.querySelector(`#${ft(t)}`)??null}async function mt(){if(ut||!K)return;ut=!0;let e=new Set;for(let t of K.spine?.items??[])t?.href&&e.add(Q(t.href));let t=K?.packaging?.manifest??K?.manifest;if(t&&typeof t==`object`)for(let n of Object.keys(t)){let r=t[n],i=r?.href,a=r?.type||r?.media_type||r?.mediaType;i&&(!a||/x?html/i.test(a))&&e.add(Q(i))}for(let t of e){let e;try{e=await Promise.race([K.load(t),new Promise((e,t)=>setTimeout(()=>t(Error(`book.load timeout`)),2500))])}catch{continue}let n=dt(e),r=new Set;n.querySelectorAll(`#inline-footnotes [id]`).forEach(e=>r.add(e)),n.querySelectorAll(`.footnote[id]`).forEach(e=>r.add(e)),n.querySelectorAll(`[role="doc-footnote"][id]`).forEach(e=>r.add(e)),n.querySelectorAll(`[epub\\:type~="footnote"][id]`).forEach(e=>r.add(e));for(let e of r){let n=e.getAttribute(`id`)||``;if(!n)continue;let r=e.cloneNode(!0),i=r.querySelector(`.sr-only strong`)?.textContent?.trim()||r.querySelector(`.sr-only`)?.textContent?.trim()||void 0;r.querySelectorAll(`.sr-only`).forEach(e=>e.remove()),r.querySelectorAll(`script, iframe, object, embed`).forEach(e=>e.remove());let a=`<div class="space-y-2 leading-relaxed">${r.innerHTML}</div>`;for(let e of Y(n))lt[e]={title:i,html:a,href:t}}}}function X(e,t){H.value=e,U.value=t,V.value=!0}function ht(){V.value=!1}function gt(e){let t=e.target?.closest?.(`a`)??null;if(!t)return;let n=t.getAttribute(`href`)||``;if(n){if(St(n)||me(t)){e.preventDefault();let r=W.value||q?.location?.start?.href||w.value?.lastHref||``;_t(n,(t.textContent||``).trim(),r);return}/^(https?:|mailto:|tel:)/i.test(n)||(e.preventDefault(),Tt(n))}}async function _t(e,t,n){let[r,i]=e.split(`#`),a=(r||``).trim(),o=(i||``).trim();if(!o)return;let s=Z(o).replace(/^#/,``);G.value=!0,H.value=`Loading…`,U.value=``;try{let{doc:e,hrefUsed:r}=await Ot(a,null,n);for(let i of Y(s)){let a=pt(e,i);if(a){let e=a.cloneNode(!0),i=e.querySelector(`.sr-only strong`)?.textContent?.trim()||e.querySelector(`.sr-only`)?.textContent?.trim()||t||s;e.querySelectorAll(`.sr-only`).forEach(e=>e.remove()),e.querySelectorAll(`script, iframe, object, embed`).forEach(e=>e.remove()),H.value=i,U.value=`<div class="space-y-2 leading-relaxed">${e.innerHTML}</div>`,W.value=r||n;return}}await mt();for(let e of Y(s)){let r=lt[e];if(r){H.value=r.title||t||s,U.value=r.html,W.value=r.href||n;return}}let i=s.replace(/^fn-/,``),o=await S(i);H.value=t||i,U.value=o?`<pre class="whitespace-pre-wrap">${$(o)}</pre>`:`<p>No definition found.</p>`}finally{G.value=!1}}async function vt(){J&&await be(y.id,J),b.push(`/`)}function yt(){if(!q)return;let e=_.value.noterefUnderline?`underline`:`none`,t=C.value?`7rem`:`1rem`;q.themes.register(`user`,{body:{background:_.value.bg,color:_.value.fg,"font-family":_.value.font,"line-height":String(_.value.lineHeight),margin:`${_.value.marginEm}em`,"text-align":`${_.value.textAlign} !important`,"padding-bottom":t},p:{"text-align":`${_.value.textAlign} !important`},'a.noteref, a[role="doc-noteref"], a[rel~="footnote"], a[epub\\:type~="noteref"]':{color:_.value.noterefColor,"text-decoration":`${e} !important`}}),q.themes.select(`user`),q.themes.fontSize(`${_.value.fontSizePct}%`)}function bt(){C.value=!C.value}function Z(e){try{return decodeURIComponent(e)}catch{return e}}function Q(e){let t=(e||``).replace(/\\/g,`/`).replace(/\/+/g,`/`).replace(/^\/+/g,``),n=[];for(let e of t.split(`/`))!e||e===`.`||(e===`..`?n.pop():n.push(e));return n.join(`/`)}function xt(e,t){let n=(e||``).replace(/\/+/g,`/`).replace(/\/+$/g,``),r=(t||``).replace(/\/+/g,`/`).replace(/^\/+/g,``);return Q(n?`${n}/${r}`:r)}function St(e){return!!e&&e.includes(`#`)&&/#(fn[-_]?|footnote|note|endnote)/i.test(e)}async function Ct(e){let t=await oe(),n=t.findIndex(e=>e.id===y.id);if(n<0)return;let r=t[n];r&&(t[n]={...r,...e},await ce(t),w.value=t[n]??null)}async function wt(){if(!K)return{idx:_e(),hrefText:{},fromCache:!1};D.value=!0,j.value=!1;try{console.info(`[search] init`,{spine:K.spine?.items?.length??0});let e=await ve(y.id,K,(e,t,n)=>{M.value=e,N.value=t,P.value=n});z=e.idx,B=e.hrefText;let t=Object.values(B).reduce((e,t)=>e+(t?.length||0),0),n=Object.entries(B)[0];console.info(`[search] text`,{totalChars:t,firstHref:n?.[0],firstSample:n?.[1]?.slice(0,120)}),j.value=!0,A.value=O.value.trim()?k(z,B,O.value.trim()):[],console.info(`[search] ready`,{chapters:Object.keys(B).length,fromCache:e.fromCache}),window.__readerDebug={status:()=>({ready:j.value,done:M.value,total:N.value,fromCache:P.value,chapters:Object.keys(B).length}),search:e=>z?k(z,B,e):[]}}catch(e){console.error(`[search] failed`,e)}finally{D.value=!1}}m(O,()=>{let e=O.value.trim();if(!e||!j.value||!z){A.value=[];return}A.value=k(z,B,e)}),m(C,()=>yt());async function Tt(e){ht(),C.value=!0,await q.display(e)}async function Et(){let e=await xe(y.id);X(`Reading analytics`,`<p>Total: <b>${Math.round(e.totalSeconds/60)}</b> minutes across <b>${e.totalSessions}</b> sessions.</p>`)}function Dt(e,t,n){let r=Z(t||``).trim(),i=Z(e||``).trim(),a=Q(r),o=Q(i),s=o.includes(`/`)?o.slice(0,o.lastIndexOf(`/`)+1):``,c=new Set;a&&c.add(xt(s,a)),a&&c.add(a);let l=[];for(let e of n?.spine?.items??[]){let t=e?.href;t&&l.push(Q(t))}let u=n?.packaging?.manifest??n?.manifest;if(u&&typeof u==`object`)for(let e of Object.keys(u)){let t=u[e],n=t?.href,r=t?.type||t?.media_type||t?.mediaType;n&&(!r||/x?html/i.test(r))&&l.push(Q(n))}let d=a.split(`/`).pop()||a;for(let e of l)e&&(e===a||e.endsWith(`/`+a)||e.endsWith(`/`+d)||e===d)&&c.add(e);return[...c]}async function Ot(e,t,n){let r=n||q?.location?.start?.href||w.value?.lastHref||``;if(!e)return t?{doc:t,hrefUsed:r}:r?{doc:dt(await Promise.race([K.load(r),new Promise((e,t)=>setTimeout(()=>t(Error(`book.load timeout`)),2500))])),hrefUsed:r}:{doc:document.implementation.createHTMLDocument(``),hrefUsed:``};let i=Dt(r,e,K),a=null;for(let e of i)try{return{doc:dt(await Promise.race([K.load(e),new Promise((e,t)=>setTimeout(()=>t(Error(`book.load timeout`)),2500))])),hrefUsed:e}}catch(e){a=e}throw a??Error(`Could not load referenced file`)}async function kt(e,t,n){let r=e.getAttribute(`href`)||``,i=(e.textContent||``).trim();if(!r||/^(https?:|mailto:|tel:)/i.test(r))return;let[a,o]=r.split(`#`),s=(a||``).trim(),c=(o||``).trim();if(!c)return;let l=Z(c).replace(/^#/,``);G.value=!0,V.value=!0,H.value=`Loading…`,U.value=``,W.value=null;let u=(e,t,n)=>{let r=e.cloneNode(!0),a=t||r.querySelector(`.sr-only strong`)?.textContent?.trim()||r.querySelector(`.sr-only`)?.textContent?.trim()||i||l;r.querySelectorAll(`.sr-only`).forEach(e=>e.remove()),r.querySelectorAll(`script, iframe, object, embed`).forEach(e=>e.remove()),H.value=a,U.value=`<div class="space-y-2 leading-relaxed">${r.innerHTML}</div>`,W.value=n};try{for(let e of Y(l)){let r=pt(t,e);if(r){u(r,void 0,n||q?.location?.start?.href||w.value?.lastHref||``);return}}try{let{doc:e,hrefUsed:r}=await Ot(s,s?null:t,n);for(let t of Y(l)){let i=pt(e,t);if(i){u(i,void 0,r||n);return}}}catch{}await mt();for(let e of Y(l)){let t=lt[e];if(t){H.value=t.title||i||l,U.value=t.html,W.value=t.href||n;return}}let e=l.replace(/^fn-/,``),r=await S(e);H.value=i||e,U.value=r?`<pre class="whitespace-pre-wrap">${$(r)}</pre>`:`<p>No definition found.</p>`}finally{G.value=!1}}function $(e){return e.replace(/[&<>"']/g,e=>({"&":`&amp;`,"<":`&lt;`,">":`&gt;`,'"':`&quot;`,"'":`&#39;`})[e])}async function At(e){try{let t=I((await K.getRange(e))?.toString());if(!t)return;let n=await jt(),r=ge({profile:T.value,selectedText:t,title:w.value?.title||`Untitled`,author:w.value?.author,chapter:n});X(`Selection`,`
          <p class="opacity-70">${$(t)}</p>
          <div class="mt-3 flex flex-wrap gap-2">
            <button id="btn-quote" class="btn btn-primary btn-sm">Copy quote</button>
            <button id="btn-define" class="btn btn-outline btn-sm">Define first word</button>
          </div>
        `),setTimeout(()=>{let e=document.getElementById(`btn-quote`),n=document.getElementById(`btn-define`);e?.addEventListener(`click`,async()=>{await navigator.clipboard.writeText(r),X(`Copied`,`<p>Quote copied with citation.</p>`)}),n?.addEventListener(`click`,async()=>{let e=t.split(/\s+/)[0]||``,n=await S(e);X(`Define: ${$(e)}`,n?`<pre class="whitespace-pre-wrap">${$(n)}</pre>`:`<p>No definition found.</p>`)})},0)}catch{}}async function jt(){try{let e=q?.location?.start?.href;return(K?.navigation?.toc??[]).find(t=>t.href&&e&&t.href.split(`#`)[0]===e.split(`#`)[0])?.label??void 0}catch{return}}async function Mt(){let e=(await oe()).find(e=>e.id===y.id)||null;if(w.value=e,!e){b.push(`/`);return}let t=await se(y.id);if(!t){b.push(`/`);return}K=pe(await t.arrayBuffer()),await K.ready,$e.value=K.navigation?.toc??[],K.spine.hooks.serialize.register(e=>e.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi,``));let n=await K.loaded.metadata,r=I(n?.title)||e.title,i=I(n?.creator)||e.author||``,a=``;try{let e=K.spine.items?.[0]?.href,t=await K.load(e);a=(new DOMParser().parseFromString(String(t),`text/html`).body?.textContent||``).slice(0,6e3)}catch{}T.value=he(r,i,a),await Ct({title:r,author:i,profile:T.value}),q=K.renderTo(x.value,{width:`100%`,height:`100%`,spread:`none`,manager:`continuous`,flow:`scrolled-doc`}),q.on(`rendered`,async(e,t)=>{let n=F.value;if(!n)return;let r=(e?.href||``).split(`#`)[0],i=(n.href||``).split(`#`)[0];!r||r!==i||(F.value=null,await at(t,n.query))}),q.hooks.content.register(e=>{let t=e.document;t.querySelectorAll(`script`).forEach(e=>e.remove());try{e.addStylesheetRules({"#inline-footnotes":{display:`none !important`},".sr-only":{display:`none !important`}})}catch{}t.addEventListener(`click`,async n=>{let r=n.target?.closest?.(`a`);if(r){if(r&&me(r)){n.preventDefault(),n.stopPropagation(),await kt(r,t,e?.section?.href||q?.location?.start?.href||w.value?.lastHref||``);return}if(_.value.studyMode&&!r){let e=t.getSelection?.();if(e&&e.toString().trim())return;let r=Date.now();if(r-E<250)return;E=r,C.value=!C.value,n.preventDefault(),n.stopPropagation()}}},!0)}),q.on(`selected`,e=>At(e)),q.on(`relocated`,async e=>{let t=e?.start?.cfi,n=e?.start?.href,r=e?.start?.percentage;await Ct({lastCfi:t,lastHref:n,lastProgress:r})}),await q.display(e.lastCfi||void 0),yt(),J=(await ye(y.id)).id,wt()}return m(()=>_.value.studyMode,e=>{e?C.value=!1:C.value=!0}),m(_,async()=>{await fe(y.id,_.value),yt()},{deep:!0}),n(async()=>{window.addEventListener(`keydown`,rt),_.value=await le(y.id).catch(()=>de),await Mt()}),d(async()=>{window.removeEventListener(`keydown`,rt);try{q&&q.destroy()}catch{}try{K&&K.destroy?.()}catch{}if(q=null,K=null,J)try{await be(y.id,J)}catch{}}),(n,l)=>(t(),v(`div`,Se,[C.value?(t(),v(`div`,Ce,[g(`div`,we,[g(`div`,Te,[g(`button`,{class:`btn btn-ghost btn-sm`,onClick:vt},`← Library`),g(`div`,Ee,u(w.value?.title),1)]),g(`div`,{class:`flex-none gap-2`},[g(`button`,{class:`btn btn-sm`,onClick:tt},`TOC`),g(`button`,{class:`btn btn-sm btn-outline`,onClick:Et},`Stats`)])]),g(`div`,De,[s(g(`input`,{class:`input input-bordered w-full`,placeholder:`Search in book…`,"onUpdate:modelValue":l[0]||=e=>O.value=e},null,512),[[h,O.value]]),D.value?(t(),v(`div`,Oe,` Indexing `+u(M.value)+`/`+u(N.value)+`… `,1)):j.value?(t(),v(`div`,ke,` Search ready (`+u(Object.keys(r(B)).length)+` chapters`+u(P.value?`, cached`:``)+`) `,1)):p(``,!0),A.value.length?(t(),v(`div`,Ae,[g(`div`,je,[(t(!0),v(te,null,c(A.value,e=>(t(),v(`div`,{key:e.href,class:`p-2 hover:bg-base-200 cursor-pointer`,onClick:t=>ot(e)},[g(`div`,Ne,u(e.href),1),g(`div`,Pe,u(e.snippet),1)],8,Me))),128))])])):p(``,!0)])])):p(``,!0),g(`div`,{class:i([[st.value,ct.value],`h-full`]),onClick:bt},[g(`div`,{ref_key:`viewer`,ref:x,class:`h-full w-full`},null,512)],2),C.value?(t(),v(`div`,{key:1,class:`fixed bottom-0 left-0 right-0 z-30 bg-base-200/95 backdrop-blur border-t border-base-300`,onClick:l[10]||=ne(()=>{},[`stop`])},[g(`div`,Fe,[g(`label`,Ie,[l[12]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Font size`)],-1),s(g(`input`,{type:`range`,min:`80`,max:`180`,step:`5`,"onUpdate:modelValue":l[1]||=e=>_.value.fontSizePct=e,class:`range range-sm`},null,512),[[h,_.value.fontSizePct,void 0,{number:!0}]])]),g(`label`,Le,[l[13]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Line height`)],-1),s(g(`input`,{type:`range`,min:`1.2`,max:`2.2`,step:`0.05`,"onUpdate:modelValue":l[2]||=e=>_.value.lineHeight=e,class:`range range-sm`},null,512),[[h,_.value.lineHeight,void 0,{number:!0}]])]),g(`label`,Re,[l[14]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Background`)],-1),s(g(`input`,{type:`color`,"onUpdate:modelValue":l[3]||=e=>_.value.bg=e,class:`input input-bordered h-10 p-1`},null,512),[[h,_.value.bg]])]),g(`label`,ze,[l[15]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Text`)],-1),s(g(`input`,{type:`color`,"onUpdate:modelValue":l[4]||=e=>_.value.fg=e,class:`input input-bordered h-10 p-1`},null,512),[[h,_.value.fg]])]),g(`label`,Be,[l[17]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Font`)],-1),s(g(`select`,{class:`select select-bordered`,"onUpdate:modelValue":l[5]||=e=>_.value.font=e},[...l[16]||=[g(`option`,{value:`ui-serif, Georgia, "Times New Roman", Times, serif`},`Serif`,-1),g(`option`,{value:`ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif`},`Sans`,-1),g(`option`,{value:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace`},`Mono`,-1)]],512),[[re,_.value.font]])]),g(`label`,Ve,[l[19]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Alignment`)],-1),s(g(`select`,{class:`select select-bordered`,"onUpdate:modelValue":l[6]||=e=>_.value.textAlign=e},[...l[18]||=[g(`option`,{value:`left`},`Left`,-1),g(`option`,{value:`justify`},`Justify`,-1),g(`option`,{value:`center`},`Center`,-1),g(`option`,{value:`right`},`Right`,-1)]],512),[[re,_.value.textAlign]])]),g(`label`,He,[g(`label`,Ue,[l[20]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Glossary link color`)],-1),s(g(`input`,{type:`color`,"onUpdate:modelValue":l[7]||=e=>_.value.noterefColor=e,class:`input input-bordered h-10 p-1`},null,512),[[h,_.value.noterefColor]])]),g(`label`,We,[l[22]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Underline glossary links`)],-1),g(`label`,Ge,[s(g(`input`,{type:`checkbox`,class:`toggle`,"onUpdate:modelValue":l[8]||=e=>_.value.noterefUnderline=e},null,512),[[ee,_.value.noterefUnderline]]),l[21]||=g(`span`,{class:`text-sm opacity-70`},`Toggle`,-1)])]),l[24]||=g(`div`,{class:`label`},[g(`span`,{class:`label-text`},`Study mode`)],-1),g(`label`,Ke,[s(g(`input`,{type:`checkbox`,class:`toggle`,"onUpdate:modelValue":l[9]||=e=>_.value.studyMode=e},null,512),[[ee,_.value.studyMode]]),l[23]||=g(`span`,{class:`text-sm opacity-70`},`Hide UI (tap screen to show/hide)`,-1)])])])])):p(``,!0),C.value?p(``,!0):(t(),v(`button`,{key:2,class:`fixed z-50 btn btn-sm opacity-80 hover:opacity-100`,style:{top:`calc(env(safe-area-inset-top) + 0.75rem)`,right:`0.75rem`},onClick:l[11]||=e=>C.value=!0,"aria-label":`Show controls`},` Show controls `)),L.value?(t(),v(`div`,qe,[g(`div`,Je,[g(`div`,{class:`flex items-center justify-between gap-3`},[l[25]||=g(`h3`,{class:`font-bold text-lg`},`Table of contents`,-1),g(`button`,{class:`btn btn-sm`,onClick:R},`Close`)]),g(`div`,Ye,[(t(!0),v(te,null,c(et.value,(e,n)=>(t(),v(`button`,{key:n,class:`btn btn-ghost btn-sm w-full justify-start text-left`,style:a({paddingLeft:`${e.depth*.75}rem`}),onClick:t=>nt(e)},u(e.label),13,Xe))),128))])]),g(`div`,{class:`modal-backdrop`,onClick:R})])):p(``,!0),e(ue,{open:V.value,title:H.value,onClose:ht},{default:o(()=>[G.value?(t(),v(`div`,Ze,`Loading…`)):(t(),v(`div`,{key:1,class:`space-y-2`,onClick:gt,innerHTML:U.value},null,8,Qe))]),_:1},8,[`open`,`title`])]))}});export{L as default};